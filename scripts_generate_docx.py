from docx import Document
from docx.shared import Pt, Cm
from docx.enum.text import WD_ALIGN_PARAGRAPH
from docx.oxml.ns import qn

# Создание документа
doc = Document()

# Поля страницы
section = doc.sections[0]
section.top_margin = Cm(2.0)
section.bottom_margin = Cm(2.0)
section.left_margin = Cm(2.5)
section.right_margin = Cm(2.0)

# Базовый стиль: Times New Roman 14 пт
style = doc.styles['Normal']
style.font.name = 'Times New Roman'
style._element.rPr.rFonts.set(qn('w:eastAsia'), 'Times New Roman')
style.font.size = Pt(14)

def add_par(text="", bold=False, italic=False, align=None, space_after=Pt(0)):
    p = doc.add_paragraph()
    run = p.add_run(text)
    run.bold = bold
    run.italic = italic
    if align:
        p.alignment = align
    pf = p.paragraph_format
    pf.line_spacing = 1.5
    pf.space_after = space_after
    return p

def add_title(text):
    p = add_par(text, bold=True, align=WD_ALIGN_PARAGRAPH.CENTER, space_after=Pt(12))
    return p

def add_h1(text):
    return add_par(text, bold=True, space_after=Pt(8))

def add_h2(text):
    p = add_par(text, bold=True)
    return p

def add_list(items):
    for it in items:
        p = doc.add_paragraph(it, style='List Bullet')
        p.paragraph_format.line_spacing = 1.5
        p.paragraph_format.space_after = Pt(0)

# Титул
add_title("Техническое задание")
add_title("по дисциплине: «Внедрение информационных систем»")
add_title("на тему: «Создание автоматизированной системы в логистике (TMS/WMS, курьеры, маршрутизация)»")
add_par()

# 1. Введение
add_h1("1. Введение")
add_par("Целью настоящего технического задания является определение целей, требований, состава работ и порядка "
        "внедрения автоматизированной системы (АС) для логистической компании. Система предназначена для автоматизации "
        "складских процессов (WMS), управления транспортом и доставкой (TMS), диспетчеризации курьеров, оптимизации "
        "маршрутов, а также обеспечения прозрачности, надежности и эффективности логистических операций.")
add_par("Актуальность проекта обусловлена необходимостью повышения скорости обработки заказов, снижения количества "
        "ошибок при учете товарно-материальных ценностей и соблюдения SLA при доставке B2B и B2C клиентам.")

# 2. Предметная область и обоснование
add_h1("2. Предметная область и обоснование проекта")
add_par("Современная логистика характеризуется высокой динамикой и неопределенностью спроса, зависимостью от внешних "
        "факторов (трафик, погодные условия, сезонность), а также необходимостью точного учета запасов и сроков годности. "
        "Разрозненные информационные системы и ручные операции приводят к задержкам, ошибкам и избыточным затратам. "
        "Единая АС позволяет стандартизировать процессы, сократить издержки и повысить качество сервиса.")
add_par("Проект ориентирован на комплексную автоматизацию: от приемки на складе до Proof of Delivery у клиента, "
        "с поддержкой маршрутизации с временными окнами и отслеживанием статусов вблизи реального времени.")

# 3. Цели и задачи
add_h1("3. Цели и задачи проекта")
add_par("Цели проекта:")
add_list([
    "— Централизация данных о заказах, остатках, маршрутах и статусах в единой системе.",
    "— Сокращение времени обработки логистического заказа (от приема до отгрузки/назначения маршрута) не менее чем на 30%.",
    "— Снижение количества ошибок складского учета до 95% за счет штрихкодирования и регламентов WMS.",
    "— Улучшение показателя On-Time и First Attempt Delivery за счет оптимизации маршрутов.",
    "— Сокращение времени формирования ежедневной отчетности до 15 минут."
])
add_par("Задачи проекта:")
add_list([
    "— Описать AS-IS и разработать TO-BE процессы (WMS/TMS, мобильное приложение курьера).",
    "— Спроектировать архитектуру, модели данных, интерфейсы и интеграции (карты/геокодинг, ЭДО/EDI, 1С).",
    "— Реализовать программные модули и провести тестирование (модульное, интеграционное, нагрузочное).",
    "— Организовать обучение пользователей и поэтапное внедрение.",
    "— Обеспечить ввод в промышленную эксплуатацию и сопровождение."
])

# 4. Область автоматизации
add_h1("4. Область автоматизации и организационная структура")
add_par("Автоматизации подлежат функции и подразделения: склады (приемка, размещение, отбор, упаковка, отгрузка, "
        "инвентаризация), транспорт/доставка (планирование рейсов, маршрутизация, назначение водителей/курьеров, "
        "контроль статусов, POD), взаимодействие с контрагентами (клиенты, перевозчики, ЭДО/EDI), аналитика и KPI.")
add_par("Система поддерживает учет по нескольким юридическим лицам в рамках единой базы данных с разграничением прав.")

# 5. Функциональные требования
add_h1("5. Требования к функциональности")
add_h2("5.1. Справочники и настройки")
add_list([
    "— Клиенты/контрагенты, адреса доставки и геозоны.",
    "— SKU/номенклатура, упаковки, единицы хранения.",
    "— Локации/ячейки, зонирование склада, правила размещения/пополнения.",
    "— Транспортные средства (габариты/грузоподъемность), экипажи.",
    "— Персонал (кладовщики, комплектовщики, курьеры/водители), роли и права.",
    "— Тарифы, SLA, временные окна, причины возвратов.",
    "— Шаблоны документов (УПД/ТТН, маршрутные/путевые листы, ярлыки)."
])
add_h2("5.2. WMS")
add_list([
    "— Приемка: по заказам/ASN, сканирование 2D, контроль расхождений, учет партий/серий/сроков (FIFO/FEFO).",
    "— Размещение: адресное хранение по правилам, пополнение зон отбора.",
    "— Отбор/комплектация: волновой/мультипикинг, контроль ошибок, упаковка, маркировка (GS1/SSCC, ZPL).",
    "— Отгрузка и кросс-докинг: консолидация, управление рампами, контроль по накладным.",
    "— Инвентаризация: циклическая, полная, ABC/XYZ; блокировки и карантинные зоны."
])
add_h2("5.3. TMS")
add_list([
    "— Прием заявок (B2B/B2C), валидация адресов, геокодирование.",
    "— Оптимизация маршрутов: временные окна, трафик, ограничения ТС, приоритеты, SLA.",
    "— Расчет загрузки по весу/объему/местам, формирование рейсов и маршрутных листов.",
    "— Назначение водителей/курьеров, контроль статусов, оповещения об отклонениях.",
    "— Proof of Delivery: фото, подпись, скан штрихкода, комментарии, обработка возвратов (RTO/RMA)."
])
add_h2("5.4. Мобильное приложение курьера/водителя")
add_list([
    "— Задания по рейсу, навигация, чат с диспетчером, офлайн-режим и синхронизация.",
    "— Сканирование штрихкодов, фотофиксация, электронная подпись.",
    "— Прием оплаты (нал/эквайринг) и фискализация — при необходимости.",
    "— Трекинг GPS/ГЛОНАСС, контроль соблюдения маршрута и временных окон."
])
add_h2("5.5. Документооборот и интеграции")
add_list([
    "— Формирование УПД/ТТН/маршрутных/путевых листов, актов расхождений/повреждений.",
    "— Интеграции с ЭДО/EDI (Диадок/СБИС и др.) — опционально.",
    "— Интеграции с картами/геокодингом (Яндекс.Карты/2ГИС/OSM).",
    "— Интеграция с бухгалтерией (1С), платежными сервисами (эквайринг), ФГИС «Честный знак» (при применимости)."
])
add_h2("5.6. Отчеты и аналитика")
add_list([
    "— Операционные отчеты: движение товаров, остатки, возраст остатков, точность инвентаризаций.",
    "— По доставке: On-Time, First Attempt Delivery, загрузка ТС, средний километраж/заказ, возвраты.",
    "— Дашборды KPI, план-факт анализ, SLA-отчеты для клиентов и перевозчиков.",
    "— Выгрузки в CSV/XLSX/PDF."
])

# 6. Нефункциональные требования
add_h1("6. Нефункциональные требования")
add_par("Производительность: одновременная работа до 30 пользователей; отклик стандартных операций (поиск SKU/заказа, "
        "назначение курьера, формирование задания) — не более 2 секунд. Длительные оптимизационные задачи выполняются "
        "асинхронно с индикацией прогресса.")
add_par("Доступность: не ниже 99% в рабочее время; резервное копирование и планы восстановления обязательны.")
add_par("Масштабируемость: горизонтальное масштабирование сервисов маршрутизации и отчетности.")
add_par("Безопасность: ролевая модель доступа, TLS, аудит действий, защита персональных данных, разделение данных по юрлицам.")
add_par("Юзабилити: интерфейсы, минимизирующие клики и ввод; мобильный UI, удобный для работы «одной рукой».")

# 7. Инфраструктура и ПО
add_h1("7. Инфраструктура и программное обеспечение")
add_par("Сервер: CPU 2+ ГГц, 8+ ГБ ОЗУ, SSD 256+ ГБ. Рабочие места: ПК с современными браузерами (Chrome/Firefox). "
        "Склад: ТСД/сканеры 2D, принтеры этикеток (ZPL), весы. Мобильные устройства: Android 10+.")
add_par("ПО сервера: Linux/Windows, PostgreSQL, Nginx/Apache. Интеграции: карты/геокодинг, ЭДО/EDI, 1С, эквайринг — по согласованию.")

# 8. План внедрения
add_h1("8. План внедрения (этапы и содержание работ)")
add_h2("8.1. Предпроектное обследование")
add_par("Интервью с диспетчерами, кладовщиками, курьерами/водителями, бухгалтерией и ИТ; описание AS-IS; выявление узких мест; "
        "формирование требований TO-BE.")
add_h2("8.2. Техническое проектирование")
add_par("Архитектура, схема БД, модели WMS/TMS, алгоритмы маршрутизации, спецификации API/интеграций, шаблоны документов, прототипы UI.")
add_h2("8.3. Рабочее проектирование и разработка")
add_par("Детальные спецификации, реализация модулей, интеграции, тестовые данные, миграция справочников, настройка ролей и бизнес-правил.")
add_h2("8.4. Тестирование")
add_par("Модульное, интеграционное, нагрузочное (маршрутизация/волновой отбор), безопасность, юзабилити; регрессия.")
add_h2("8.5. Обучение")
add_par("Обучение администраторов, диспетчеров, кладовщиков/комплектовщиков, курьеров/водителей; методические материалы, видеоинструкции.")
add_h2("8.6. Пробная эксплуатация")
add_par("Один склад/депо и один маршрут (не менее 3 недель); фиксация KPI (On-Time, скорость обработки, точность учета), устранение дефектов.")
add_h2("8.7. Приемочные испытания и ввод в промышленную эксплуатацию")
add_par("Сценарии WMS/TMS и мобильного приложения, отчетность, безопасность и производительность; подписание Акта сдачи-приемки, запуск.")

# 9. Порядок и критерии приемки
add_h1("9. Порядок и критерии приемки")
add_list([
    "— Достижение целевых показателей: время обработки −30%; точность учета ≥95%; отчетность ≤15 минут; On-Time по целевому уровню.",
    "— Отсутствие критических дефектов.",
    "— Успешное прохождение контрольных сценариев.",
    "— Корректность формируемых документов (УПД/ТТН/маршрутные листы)."
])
add_par("Документы приемки: протоколы испытаний, акт готовности к приемке, Акт сдачи-приемки.")

# 10. Риски и качество
add_h1("10. Управление рисками и качеством")
add_par("Ключевые риски: некачественные исходные данные (адреса, справочники), сопротивление изменениям у персонала, задержки интеграций, "
        "пиковые нагрузки. Меры: очистка и валидация данных, поэтапное внедрение и обучение, SLA с провайдерами, нагрузочные тесты и запас "
        "производительности, резервные процедуры при сбоях интеграций (fallback).")

# 11. Экономическое обоснование
add_h1("11. Экономическое обоснование (укрупненно)")
add_par("Затраты: разработка/лицензии, оборудование (ТСД/принтеры), интеграции, обучение, поддержка. Выгоды: сокращение трудозатрат и времени "
        "операций, снижение возвратов и ошибок учета, оптимизация маршрутов и затрат на топливо, повышение уровня сервиса и удержания клиентов. "
        "Окупаемость достигается за счет снижения операционных издержек и роста выручки от улучшенного SLA.")

# 12. Информационная безопасность
add_h1("12. Требования к безопасности и ИБ")
add_list([
    "— Ролевая модель доступа (администратор, диспетчер, кладовщик/комплектовщик, водитель/курьер, бухгалтер, аналитик).",
    "— Шифрование трафика (TLS), защита ПДн, аудит действий пользователей.",
    "— Журналирование интеграций, разграничение доступа к данным разных юрлиц.",
    "— Регулярные обновления и устранение уязвимостей, резервное копирование (RTO/RPO по согласованию)."
])

# 13. Документирование и обучение
add_h1("13. Документирование и обучение пользователей")
add_list([
    "— ТЗ (настоящий документ), Технический проект, Программа и методики испытаний.",
    "— Руководство администратора; руководства пользователей (диспетчер, кладовщик/комплектовщик, курьер/водитель, бухгалтер, аналитик).",
    "— Форматы отчетов и выходных документов; протоколы испытаний; Акт сдачи-приемки.",
    "— Обязательное обучение по ролям с практическими упражнениями."
])

# 14. Заключение
add_h1("14. Заключение")
add_par("Внедрение АС в логистике повышает управляемость и прозрачность процессов, снижает издержки и обеспечивает предсказуемость SLA. "
        "Настоящее ТЗ определяет рамки и критерии успешности проекта в учебной дисциплине «Внедрение информационных систем» и может служить "
        "основой для курсового/проектного выполнения, прототипирования и оценки результатов.")

# Список источников
add_par()
add_h1("Список источников")
add_list([
    "1. ГОСТ 34.602-2020 «Информационная технология. Комплекс стандартов на автоматизированные системы. Техническое задание».",
    "2. Внутренние регламенты складских и транспортных операций (WMS/TMS) организации.",
    "3. Методические материалы по маршрутизации и диспетчеризации курьерской доставки."
])

# Приложения (для объема ~10 страниц)
add_par()
add_h1("Приложение А. Модель данных (укрупненно)")
add_par("Сущности: Заказ, Позиция заказа, Клиент, Адрес, SKU, Единица хранения, Ячейка, Транспортное средство, Рейс, Курьер, "
        "Скан-событие, Документ (УПД/ТТН), Пользователь, Роль.")
add_par("Связи: Заказ—Позиция (1—N), Рейс—Заказ (1—N), Клиент—Адрес (1—N), SKU—Ед. хранения (1—N), Пользователь—Роль (M—N).")

add_h1("Приложение Б. Сценарии тестирования (выдержка)")
add_list([
    "— Приемка по ASN с излишками/недостачами.",
    "— Волновой отбор для 50+ заказов с маркировкой SSCC.",
    "— Маршрутизация с временными окнами и ограничениями ТС.",
    "— Подтверждение доставки (POD) в офлайн‑режиме и последующая синхронизация.",
    "— Инвентаризация циклическая (ABC) с расхождениями.",
    "— Генерация УПД/ТТН и выгрузка в ЭДО."
])

add_h1("Приложение В. Риск‑реестр (фрагмент)")
add_list([
    "— Риск качества данных (адреса, справочники) → Митигировать валидацией и ETL‑очисткой.",
    "— Риск интеграций (ЭДО/карты/1С) → Контракты SLA, fallback‑процедуры.",
    "— Риск обучения пользователей → Обязательная практика на контрольных сценариях.",
    "— Пиковые нагрузки → Нагрузочное тестирование, резерв ресурсов."
])

# Сохранение
doc.save("TZ_Logistics.docx")
print("Generated: TZ_Logistics.docx")